<?xml version='1.0' encoding="gb2312"?>
<!DOCTYPE sqlMap PUBLIC "-//iBATIS.com//DTD SQL Map 2.0//EN"
    "http://www.ibatis.com/dtd/sql-map-2.dtd">

<!-- WARNING: This is an autogenerated file -->

<sqlMap namespace="cms_CmsPage">        
    <typeAlias alias="CmsTopicPage" type="com.alibaba.china.cmshollywood.cms.dal.dataobject.CmsTopicPage"/>
    <typeAlias alias="CmsPage" type="com.alibaba.china.cmshollywood.cms.dal.dataobject.CmsPage"/>
    <resultMap class="CmsPage" id="CmsPage-result" >
        <result property="gmtCreate"	javaType="java.sql.Timestamp"	column="GMT_CREATE" />
        <result property="gmtModified"	javaType="java.sql.Timestamp"	column="GMT_MODIFIED" />
        <result property="id"			javaType="java.lang.Long"		column="ID" />
        <result property="catalogId"	javaType="java.lang.Long"		column="CATALOG_ID" />
        <result property="title"		javaType="java.lang.String"		column="TITLE" />
        <result property="keywords"		javaType="java.lang.String"		column="KEYWORDS" />
        <result property="header"		javaType="java.lang.String"		column="HEADER" />
        <result property="style"		javaType="java.lang.String"		column="STYLE" />
        <result property="description"	javaType="java.lang.String"		column="DESCRIPTION" />
        <result property="status"		javaType="java.lang.String"		column="STATUS" />
		<result property="specificUrl"	javaType="java.lang.String"		column="SPECIFIC_URL" />
		<result property="domainPathId"	javaType="java.lang.Long"		column="DOMAIN_PATH_ID" />
		<result property="footer"		javaType="java.lang.String"		column="FOOTER" />
		<result property="intervalTime" javaType="java.lang.String"		column="INTERVAL_TIME" />
		<result property="pageType"     javaType="java.lang.String"		column="PAGE_TYPE" />
		<result property="tag"     		javaType="java.lang.String"		column="TAG" />
		<result property="gridType"     		javaType="java.lang.String"		column="GRID_TYPE" />
		<result property="url"     		javaType="java.lang.String"		column="URL" />
		<result property="applyDevice" column="APPLY_DEVICE" javaType="java.lang.String" />
		<result property="boxPageType" column="BOX_PAGE_TYPE" javaType="java.lang.String" />
    </resultMap>
    
    <resultMap class="CmsPage" id="CmsPageForClean-result" >
        <result property="id"			javaType="java.lang.Long"		column="ID" />
		<result property="specificUrl"	javaType="java.lang.String"		column="SPECIFIC_URL" />
    </resultMap>
    <resultMap class="hashMap" id="CmsPageMap-result" >
        <result property="id"			javaType="java.lang.Long"		column="ID" />
		<result property="pageType"	javaType="java.lang.String"		column="PAGE_TYPE" />
    </resultMap>
    
    <resultMap class="hashMap" id="box-page-map" >
        <result property="gmtModified"	javaType="java.sql.Timestamp"	column="GMT_MODIFIED" />
        <result property="id"			javaType="java.lang.Long"		column="ID" />
        <result property="userId"		javaType="java.lang.String"		column="USER_ID" />
        <result property="title"		javaType="java.lang.String"		column="TITLE" />
        <result property="status"		javaType="java.lang.String"		column="STATUS" />
	    <result property="specificUrl"	javaType="java.lang.String"		column="SPECIFIC_URL" />
	    <result property="tag"     		javaType="java.lang.String"		column="TAG" />
    </resultMap>    

	<resultMap class="CmsPage" id="CmsPage-result-release-time" extends="CmsPage-result" >
		<result property="releaseTime"	javaType="java.sql.Timestamp"	column="RELEASE_TIME" />
		<result property="userId"		javaType="java.lang.String"		column="USER_ID" />
    </resultMap>
	<resultMap class="CmsTopicPage" id="CmsTopicPage-result" extends="CmsPage-result-release-time" >
		<result property="pageStatus"	javaType="java.lang.String"	column="PAGE_STATUS" />
		<result property="approveUserId"		javaType="java.lang.String"		column="APPROVE_USER_ID" />
		<result property="remark"		javaType="java.lang.String"		column="REMARK" />
		<result property="modifier"		javaType="java.lang.String"		column="MODIFIER" />
		<result property="lastPublishTime" javaType="java.sql.Timestamp" column="LAST_PUBLISH_TIME" />
    </resultMap>
    <resultMap id="CmsMyPageResult" class="java.util.HashMap">
        <result property="pageId"	javaType="java.lang.Long"	column="ID" />
        <result property="title"		column="TITLE" />
        <result property="status"		column="STATUS" />
		<result property="pageType"     column="PAGE_TYPE" />
		<result property="url"     		column="URL" />
		<result property="applyDevice"  column="APPLY_DEVICE"/>
		<result property="publishTime"	column="LAST_PUBLISH_TIME" />
		<result property="creator"	column="USER_ID" />
		<result property="gmtCreate" column="GMT_CREATE" javaType="java.sql.Timestamp" />
		<result property="gmtModified" column="GMT_MODIFIED" javaType="java.sql.Timestamp" />
		<result property="modifier"	column="MODIFIER" />
		<result property="siteName"	column="SITE_NAME" />
    </resultMap>
    <resultMap id="CmsMyReleasedPageResult" class="java.util.HashMap">
        <result property="pageId"	javaType="java.lang.Long"	column="ID" />
        <result property="title"		column="TITLE" />
        <result property="status"		column="STATUS" />
		<result property="pageType"     column="PAGE_TYPE" />
		<result property="url"     		column="URL" />
		<result property="applyDevice"  column="APPLY_DEVICE"/>
		<result property="publishTime"	column="LAST_PUBLISH_TIME" />
		<result property="modifier"	column="MODIFIER" />
    </resultMap>
    
    <select id="getCmsPage" resultClass="CmsPage" parameterClass="CmsPage" resultMap="CmsPage-result" >
        <![CDATA[
            select * from CMS_PAGE where  ID = #id# 
        ]]>
    </select>

    <update id="MS-UPDATE-CMSPAGE-BY-ID" parameterClass="CmsPage" >
            update
                        CMS_PAGE
            set
                    GMT_MODIFIED = sysdate,
                    RELEASE_TIME = #releaseTime#,
					INTERVAL_TIME = #intervalTime# 
		<dynamic prepend = "">
                <isNotNull property = "catalogId" prepend = ",">CATALOG_ID = #catalogId#</isNotNull>
                <isNotNull property = "title" prepend = ",">TITLE = #title#</isNotNull>
                <isNotNull property = "keywords" prepend = ",">KEYWORDS = #keywords#</isNotNull>
                <isNotNull property = "style" prepend = ","> STYLE = #style#</isNotNull>
                <isNotNull property = "header" prepend = ",">HEADER = #header#</isNotNull>
                <isNotNull property = "description" prepend = ",">DESCRIPTION = #description#</isNotNull>
                <isNotNull property = "status" prepend = ",">STATUS = #status#</isNotNull>
                <isNotNull property = "footer" prepend = ",">FOOTER = #footer#</isNotNull>
                <isNotNull property = "domainPathId" prepend = ",">DOMAIN_PATH_ID = #domainPathId#</isNotNull>
                <isNotNull property = "specificUrl" prepend = ",">SPECIFIC_URL = #specificUrl#</isNotNull>
				<isNotNull property = "tag" prepend = ",">TAG = #tag#</isNotNull>
				<isNotNull property = "gridType" prepend = ",">GRID_TYPE = #gridType#</isNotNull>
				<isNotNull property = "url" prepend = ",">URL = #url#</isNotNull>
				<isNotNull property = "applyDevice" prepend = ",">APPLY_DEVICE = #applyDevice#</isNotNull>
				<isNotNull property = "boxPageType" prepend = ",">BOX_PAGE_TYPE = #boxPageType#</isNotNull>
        </dynamic>
		where ID = #id#			
    </update>

    <insert id="MS-INSERT-CMSPAGE" parameterClass="CmsPage" >
         <selectKey resultClass="java.lang.Long" keyProperty="id">
            SELECT SEQ_CMS_PAGE.NEXTVAL AS id FROM DUAL
        </selectKey>
		<![CDATA[
            insert into CMS_PAGE
              (GMT_CREATE  , GMT_MODIFIED  , ID  , CATALOG_ID  , TITLE  , KEYWORDS  , HEADER  , STYLE  , DESCRIPTION  , STATUS ,SPECIFIC_URL,DOMAIN_PATH_ID,FOOTER,INTERVAL_TIME,PAGE_TYPE,TAG, USER_ID, RELEASE_TIME,GRID_TYPE,URL,APPLY_DEVICE,BOX_PAGE_TYPE,MODIFIER)
            values
              (SYSDATE  , SYSDATE  , #id#  , #catalogId#  , #title#  , #keywords#  , #header#  , #style#  , #description#  , #status# ,#specificUrl#,#domainPathId#,#footer#,#intervalTime#,#pageType#,#tag#, #userId#, #releaseTime#,#gridType#,#url#,#applyDevice#,#boxPageType#,#userId#)
        ]]>
    </insert>

    <insert id="MS-INSERT-CMSPAGE2" parameterClass="CmsPage" >
		<![CDATA[
            insert into CMS_PAGE
              (GMT_CREATE  , GMT_MODIFIED  , ID  , CATALOG_ID  , TITLE  , KEYWORDS  , HEADER  , STYLE  , DESCRIPTION  , STATUS ,SPECIFIC_URL,DOMAIN_PATH_ID,FOOTER,INTERVAL_TIME,PAGE_TYPE,TAG,GRID_TYPE,URL,APPLY_DEVICE,MODIFIER)
            values
              (#gmtCreate#  , #gmtModified#  , #id#  , #catalogId#  , #title#  , #keywords#  , #header#  , #style#  , #description#  , #status# ,#specificUrl#,#domainPathId#,#footer#,#intervalTime#,#pageType#,#tag#,#gridType#,#url#,#applyDevice#,#userId#)
        ]]>
    </insert>


    <delete id="deleteCmsPage" parameterClass="CmsPage"  >
        <![CDATA[
            delete from CMS_PAGE where ID = #id# 
        ]]>
    </delete>


    
	<select id="MS-SELECT-CMSPAGE-BY-SEARCH"  resultMap="CmsPage-result-release-time" parameterClass="map">
	  <![CDATA[
            SELECT * FROM CMS_PAGE 
      ]]>
            <dynamic prepend="WHERE">
				  <isNotEmpty prepend="AND" property="title" >
			        instr(title, #title#)>0
			      </isNotEmpty>
				  <isNotNull prepend="AND" property="siteId">
					ID in (SELECT RESOURCE_ID FROM CMS_RESOURCE_SITE where RESOURCE_TYPE='page'
					 and  SITE_ID in 
					 <iterate property="siteId" open="(" close=")" conjunction=",">
		                      #siteId[]#
		            </iterate>
					)
			      </isNotNull>
				  <isNotNull prepend="AND" property="catalogId">
					ID in (SELECT RESOURCE_ID FROM CMS_RESOURCE_CATALOG_V2 where RESOURCE_TYPE='page'
					 and  CATALOG_ID in 
					 <iterate property="catalogId" open="(" close=")" conjunction=",">
		                      #catalogId[]#
		            </iterate>
					)
			      </isNotNull>
			      <isNotEmpty prepend="AND" property="keywords" >
			        instr(KEYWORDS, #keywords#)>0
			      </isNotEmpty>
				  <isGreaterThan prepend="AND" property="domainId" compareValue="0">
					DOMAIN_PATH_ID in (SELECT ID FROM CMS_DOMAIN_PATH WHERE DOMAIN_ID=#domainId#)
			      </isGreaterThan>
			  <isNotEmpty prepend="AND" property = "specialUrl">
			  	instr(SPECIFIC_URL, #specialUrl#)>0
			  </isNotEmpty>	
			  <isNotEmpty prepend="AND" property="pageType" >	
			        PAGE_TYPE = #pageType#
			  </isNotEmpty>	
			  <isNotEmpty prepend="AND" property="url" >	
			        URL = #url#
			  </isNotEmpty>
			   <isNotEmpty prepend="AND" property="userId" >	
			        USER_ID = #userId#
			  </isNotEmpty>			      
            </dynamic>
      <![CDATA[
            ORDER BY ID DESC
      ]]>
    </select>
     
	

    <select id="MS-SELECT-CMSPAGE-BY-ID"  resultMap="CmsPage-result-release-time" parameterClass="java.lang.Long">
            SELECT * FROM CMS_PAGE WHERE ID =#pageId#	
    </select>
    
      <select id="MS-SELECT-CMSPAGE-BY-PUBLICBLOCKID"  resultMap="CmsPage-result" parameterClass="java.util.Map">
		 <![CDATA[	select *
			  from (SELECT A.*, ROWNUM RN
			          FROM (select *
			                  from cms_page p
			                 where p.id in (select p.start_id
			                                  from cms_page_resource p
			                                 where p.start_type = #start_type#
			                                   and p.end_id = #publicBlockId#)
			                 order by p.gmt_modified desc) A
			         WHERE ROWNUM <= #offset# + #length#)
			 WHERE RN > #offset#         ]]>
    </select>
    <select id="MS-SELECT-COUNT-CMSPAGE-BY-PUBLICBLOCKID"  resultClass="java.lang.Integer"   parameterClass="java.util.Map">
		 <![CDATA[	 select  count(*)
			                  from cms_page p
			                 where p.id in (select p.start_id
			                                  from cms_page_resource p
			                                 where p.start_type = 'public_block'
			                                   and p.end_id = #publicBlockId#)          ]]>
    </select>
    
	<select id="MS-SELECT-CMSPAGE-BY-DPID-SPECIAL"  resultMap="CmsPage-result" parameterClass="java.util.Map">
            SELECT * FROM CMS_PAGE WHERE SPECIFIC_URL=#specialUrl# and DOMAIN_PATH_ID = #domainPId#	
    </select>
    
	<update id="MS-UPDATE-CMSPAGE-STATUS-BY-PAGEID" parameterClass="java.util.Map" >
        UPDATE CMS_PAGE
        SET
                GMT_MODIFIED = SYSDATE, 
                STATUS = #status#
                <dynamic prepend = "">
					<isNotNull property = "modifier" prepend = ",">MODIFIER = #modifier#</isNotNull>
					<isNotNull property = "lastPublishTime" prepend = ",">LAST_PUBLISH_TIME = #lastPublishTime#</isNotNull>
		        </dynamic>
        WHERE  
            ID = #pageId#
    </update>
	<select id="MS-SELECT-CMSPAGE-BY-IDS"  resultMap="CmsPage-result-release-time" parameterClass="java.util.Map">
              SELECT * FROM CMS_PAGE 
				<iterate prepend="WHERE" property="pageIdList" open="(" close=")" conjunction="OR">
		                      ID =#pageIdList[]#
		        </iterate>
			   ORDER BY GMT_MODIFIED DESC
    </select>
	<select id="MS-SELECT-CMSPAGE-UNCHECK"  resultMap="CmsPage-result" parameterClass="java.util.Map">
    <![CDATA[
      SELECT * FROM (
         SELECT A.*,ROWNUM RN FROM (
            SELECT * FROM CMS_PAGE 
      ]]>
           WHERE STATUS = #status# and CATALOG_ID!=#catalog#
      <![CDATA[
            ORDER BY GMT_MODIFIED DESC
         ) A WHERE ROWNUM <= #offset# + #length#
      ) WHERE RN > #offset#
      ]]>
    </select>
	<select id="MS-COUNT-CMSPAGE-BY-UNCHECK"  resultClass="java.lang.Integer" parameterClass="java.util.Map">
	      SELECT count(*) FROM CMS_PAGE WHERE STATUS = #status# and CATALOG_ID!=#catalog#
	</select>
	<select id="MS_SELECT_PAGE_BY_CATALOG_ID" resultMap="CmsPage-result" parameterClass="java.lang.Long">
		<![CDATA[
			SELECT * FROM CMS_PAGE WHERE CATALOG_ID = #catalogId# ORDER BY ID DESC
		]]>		
	</select>

	<update id="MS_UPDATE_CATALOG_ID_BY_ID" parameterClass="map">
		<![CDATA[
			UPDATE CMS_PAGE SET CATALOG_ID = #catalogId# where ID in
		]]>
		<iterate property="idList" open="(" close=")" conjunction=",">
			#idList[]#
		</iterate>
	</update>

	<select id="MS-SELECT-CMSPAGE-BY-TITLE-CATALOGID"  resultMap="CmsPage-result" parameterClass="java.util.Map">
        <![CDATA[
		SELECT * FROM (
			SELECT * FROM CMS_PAGE 
			WHERE CATALOG_ID = #catalog#	
			AND STATUS = #status#
		]]>
		<isEqual compareValue="CK"   property="order">
		<![CDATA[
			ORDER BY GMT_MODIFIED DESC
		]]>
		</isEqual>
		<isEqual compareValue="CR"   property="order">
		<![CDATA[
			ORDER BY GMT_CREATE DESC
		]]>
		</isEqual>
		<![CDATA[
			) WHERE ROWNUM <= #length# 
		]]>
    </select>
	
	<select id="MS_SELECT_CMSPAGE_BY_IDS"  resultMap="CmsPage-result" parameterClass="java.util.Map">
		<![CDATA[
			SELECT * FROM (
				SELECT page.* , ROWNUM rn FROM (
					SELECT * FROM CMS_PAGE where  
		]]>
			<iterate property="pageIdList" open="(" close=")"  conjunction="OR">
				ID = #pageIdList[]#
			</iterate>		
			<isGreaterThan prepend="AND" property="catalogId" compareValue="0">
				CATALOG_ID = #catalogId#
			</isGreaterThan>
			<isNotEmpty prepend="AND" property="specificUrl">
				SPECIFIC_URL like '%'||#specificUrl#||'%'
			</isNotEmpty>		
		<![CDATA[
			ORDER BY GMT_CREATE DESC
			) page WHERE ROWNUM <= #offset# + #length#
		) WHERE rn> #offset#
		]]>
    </select>
    
    	<select id="MS_SELECT_CMSPAGE_BY_PAGEIDS"  resultMap="CmsPage-result" parameterClass="java.util.Map">
		<![CDATA[
			SELECT * FROM (
				SELECT page.* , ROWNUM rn FROM (
					SELECT * FROM CMS_PAGE where  
		]]>
			<iterate property="pageIdList" open="(" close=")"  conjunction="OR">
				ID = #pageIdList[]#
			</iterate>			
		<![CDATA[
			ORDER BY GMT_CREATE DESC
			) page WHERE ROWNUM <= #offset# + #length#
		) WHERE rn> #offset#
		]]>
    </select>
    
	<select id="MS_SELECT_CMSPAGE_COUNT_BY_IDS"  resultClass="java.lang.Long" parameterClass="java.util.Map">
		<![CDATA[
			SELECT COUNT(*) FROM CMS_PAGE WHERE  
		]]>
			<iterate property="pageIdList" open="(" close=")" conjunction="OR">
				ID = #pageIdList[]#
			</iterate>
			<isGreaterThan prepend = "AND" property = "catalogId" compareValue = "0">
				CATALOG_ID = #catalogId#
			</isGreaterThan>
			<isNotEmpty prepend = "AND" property="specificUrl">
				SPECIFIC_URL like '%'||#specificUrl#||'%'
			</isNotEmpty>
    </select>
	
    <!-- 根据多个二级类目id已经提取页面的范围，提取页面 -->
	<select id="MS_SELECT_CMSPAGE_BY_CATALOGIDS_AND_SCOPE"  resultMap="CmsPage-result" parameterClass="java.util.Map">
        <![CDATA[
			SELECT * FROM (
				SELECT page.*, ROWNUM rn FROM (
		            SELECT * FROM CMS_PAGE WHERE  STATUS = #status# AND id IN
		]]>		
		(SELECT RESOURCE_ID FROM CMS_RESOURCE_CATALOG_V2 where RESOURCE_TYPE='page'
					 and  CATALOG_ID in 
					 <iterate property="categoryIds" open="(" close=")" conjunction=",">
		                      #categoryIds[]#
		            </iterate>
					)
		<isEqual compareValue="CK" property="order">
			ORDER BY GMT_MODIFIED DESC
		</isEqual>
		<isEqual compareValue="CR" property="order">
			ORDER BY GMT_CREATE DESC
		</isEqual>
		<![CDATA[
			    ) page WHERE ROWNUM < #totalNum# + #startNum#
		    ) WHERE rn >= #startNum#
		]]>
		
    </select>
	
	<select id="MS_SELECT_CMSPAGE_COUNT_BY_HEADER"  resultClass="java.lang.Long" parameterClass="java.util.Map">
	<![CDATA[
	      SELECT count(*) FROM CMS_PAGE WHERE HEADER = #headerName#
	      ]]>
	      <isGreaterThan prepend="AND" property="catalogId" compareValue="0">
				CATALOG_ID = #catalogId#
		  </isGreaterThan>
		  <isNotEmpty prepend="AND" property="specificUrl">
				SPECIFIC_URL like '%'||#specificUrl#||'%'
		  </isNotEmpty>
		  <isNotEmpty prepend="AND" property="title" >
	        instr(title, #title#)>0
	      </isNotEmpty>
		  <isGreaterThan prepend="AND" property="domainId" compareValue="0">
					 DOMAIN_PATH_ID in (SELECT ID FROM CMS_DOMAIN_PATH WHERE DOMAIN_ID=#domainId#)
		 </isGreaterThan>
		  <isNotEmpty prepend="AND" property="pageType" >	
		         PAGE_TYPE = #pageType#
		  </isNotEmpty>
		  <isNotEmpty property="applyDevice" prepend="">
			 <isNotEqual    prepend="and" property="applyDevice" compareValue="all">		             
			        (APPLY_DEVICE = #applyDevice# or  APPLY_DEVICE ='all'  or APPLY_DEVICE is null)			          
		      </isNotEqual>
		      <isEqual  prepend="and" property="applyDevice" compareValue="all">	
		            (APPLY_DEVICE ='all'  or APPLY_DEVICE is null)
		      </isEqual>
		  </isNotEmpty>
	</select>
		<select id="MS_SELECT_CMSPAGE_COUNT_BY_FOOTER"  resultClass="java.lang.Long" parameterClass="java.util.Map">
	<![CDATA[
	      SELECT count(*) FROM CMS_PAGE WHERE FOOTER = #footerName#
	      ]]>
	      <isGreaterThan prepend="AND" property="catalogId" compareValue="0">
				CATALOG_ID = #catalogId#
		  </isGreaterThan>
		  <isNotEmpty prepend="AND" property="specificUrl">
				SPECIFIC_URL like '%'||#specificUrl#||'%'
		  </isNotEmpty>
	</select>
	
	<select id="MS_PAGINATE_SELECT_CMSPAGE_BY_HEADER"  resultMap="CmsPage-result" parameterClass="java.util.Map">
	<![CDATA[
		SELECT GMT_CREATE, GMT_MODIFIED, ID, CATALOG_ID, TITLE, KEYWORDS, HEADER, STYLE, DESCRIPTION, STATUS, SPECIFIC_URL, DOMAIN_PATH_ID, FOOTER, INTERVAL_TIME, PAGE_TYPE, TAG,GRID_TYPE,URL,APPLY_DEVICE,BOX_PAGE_TYPE FROM
		(
			SELECT A.GMT_CREATE, A.GMT_MODIFIED, A.ID, A.CATALOG_ID, A.TITLE, A.KEYWORDS, A.HEADER, A.STYLE, A.DESCRIPTION, A.STATUS, A.SPECIFIC_URL, A.DOMAIN_PATH_ID, A.FOOTER, A.INTERVAL_TIME, A.PAGE_TYPE, A.TAG,A.GRID_TYPE,A.URL,APPLY_DEVICE,A.BOX_PAGE_TYPE, ROWNUM rn FROM
			(
		    	SELECT GMT_CREATE, GMT_MODIFIED, ID, CATALOG_ID, TITLE, KEYWORDS, HEADER, STYLE, DESCRIPTION, STATUS, SPECIFIC_URL, DOMAIN_PATH_ID, FOOTER, INTERVAL_TIME, PAGE_TYPE, TAG,GRID_TYPE,URL,APPLY_DEVICE,BOX_PAGE_TYPE FROM CMS_PAGE WHERE HEADER = #headerName# 
		    	]]>
		    <isGreaterThan prepend="AND" property="catalogId" compareValue="0">
				CATALOG_ID = #catalogId#
		  	</isGreaterThan>
		  	<isNotEmpty prepend="AND" property="specificUrl">
				SPECIFIC_URL like '%'||#specificUrl#||'%'
		  	</isNotEmpty>
		  	  <isNotEmpty prepend="AND" property="url">
				URL = #url#
		  	</isNotEmpty>
		  	  <isNotEmpty prepend="AND" property="title" >
		        instr(title, #title#)>0
		      </isNotEmpty>
			  <isGreaterThan prepend="AND" property="domainId" compareValue="0">
						 DOMAIN_PATH_ID in (SELECT ID FROM CMS_DOMAIN_PATH WHERE DOMAIN_ID=#domainId#)
			 </isGreaterThan>
			  <isNotEmpty prepend="AND" property="pageType" >	
			         PAGE_TYPE = #pageType#
			  </isNotEmpty>
			  <isNotEmpty property="applyDevice" prepend="">
				 <isNotEqual    prepend="and" property="applyDevice" compareValue="all">		             
				        (APPLY_DEVICE = #applyDevice# or  APPLY_DEVICE ='all'  or APPLY_DEVICE is null)			          
			      </isNotEqual>
			      <isEqual  prepend="and" property="applyDevice" compareValue="all">	
			            (APPLY_DEVICE ='all'  or APPLY_DEVICE is null)
			      </isEqual>
			  </isNotEmpty>
		    <![CDATA[
		    ORDER BY ID DESC ) A
	    	WHERE ROWNUM <= #offset# + #length#
	    )
	    WHERE rn > #offset#
	    ]]>
	</select>
		<select id="MS_PAGINATE_SELECT_CMSPAGE_BY_FOOTER"  resultMap="CmsPage-result" parameterClass="java.util.Map">
	<![CDATA[
		SELECT GMT_CREATE, GMT_MODIFIED, ID, CATALOG_ID, TITLE, KEYWORDS, HEADER, STYLE, DESCRIPTION, STATUS, SPECIFIC_URL, DOMAIN_PATH_ID, FOOTER, INTERVAL_TIME, PAGE_TYPE, TAG,GRID_TYPE,URL,APPLY_DEVICE,BOX_PAGE_TYPE FROM
		(
			SELECT A.GMT_CREATE, A.GMT_MODIFIED, A.ID, A.CATALOG_ID, A.TITLE, A.KEYWORDS, A.HEADER, A.STYLE, A.DESCRIPTION, A.STATUS, A.SPECIFIC_URL, A.DOMAIN_PATH_ID, A.FOOTER, A.INTERVAL_TIME, A.PAGE_TYPE, A.TAG,A.GRID_TYPE,A.URL,APPLY_DEVICE,A.BOX_PAGE_TYPE, ROWNUM rn FROM
			(
		    	SELECT GMT_CREATE, GMT_MODIFIED, ID, CATALOG_ID, TITLE, KEYWORDS, HEADER, STYLE, DESCRIPTION, STATUS, SPECIFIC_URL, DOMAIN_PATH_ID, FOOTER, INTERVAL_TIME, PAGE_TYPE, TAG,GRID_TYPE,URL,APPLY_DEVICE,BOX_PAGE_TYPE FROM CMS_PAGE WHERE FOOTER = #footerName# 
		    	]]>
		    <isGreaterThan prepend="AND" property="catalogId" compareValue="0">
				CATALOG_ID = #catalogId#
		  	</isGreaterThan>
		  	<isNotEmpty prepend="AND" property="specificUrl">
				SPECIFIC_URL like '%'||#specificUrl#||'%'
		  	</isNotEmpty>
		  	  <isNotEmpty prepend="AND" property="url">
				URL = #url#
		  	</isNotEmpty>
		    <![CDATA[
		    ORDER BY ID DESC ) A
	    	WHERE ROWNUM <= #offset# + #length#
	    )
	    WHERE rn > #offset#
	    ]]>
	</select>
	
	
	
	<select id="MS_GET_PAGELIST_BY_PAGEIDS_AND_CATALOGID"  resultMap="CmsPage-result" parameterClass="java.util.Map">
		<![CDATA[
			SELECT GMT_CREATE,GMT_MODIFIED,ID,CATALOG_ID,
			       TITLE,KEYWORDS,HEADER,STYLE,DESCRIPTION,
			       STATUS,SPECIFIC_URL,DOMAIN_PATH_ID,FOOTER,
			       INTERVAL_TIME,PAGE_TYPE,TAG ,GRID_TYPE,URL,APPLY_DEVICE,BOX_PAGE_TYPE
			FROM   CMS_PAGE
			WHERE  
		]]>
			<iterate property="pageIdList" open="(" close=")"  conjunction="OR">
				ID = #pageIdList[]#
			</iterate>		
			<isGreaterThan prepend="AND" property="catalogId" compareValue="0">
				CATALOG_ID = #catalogId#
			</isGreaterThan>
			<isNotEmpty prepend="AND" property="specificUrl">
				SPECIFIC_URL like '%'||#specificUrl#||'%'
			</isNotEmpty>	
			<isNotEmpty prepend="AND" property="url">
				URL = #url#
			</isNotEmpty>		
		<![CDATA[
			ORDER BY ID DESC
		]]>
    </select>
    
    <!-- 锟斤拷取锟斤拷锟叫碉拷页锟斤拷URL-->
	<select id="MS_SELECT_CMSPAGE_BYTIME_DIVIDE"  resultMap="CmsPage-result" parameterClass="java.util.Map">
        <![CDATA[
			SELECT * FROM (
				SELECT page.*, ROWNUM rn FROM (
		            SELECT * FROM CMS_PAGE 
		]]>		
		<isEqual compareValue="NODATE" property="date">
			<![CDATA[
			WHERE GMT_CREATE >= TO_DATE(#startTime#,'YYYY-MM-DD-HH24:MI') 
			      AND  GMT_CREATE < TO_DATE(#endTime#,'YYYY-MM-DD-HH24:MI')
			]]>	
		</isEqual>
		    ORDER BY GMT_CREATE DESC
		<![CDATA[
			    ) page WHERE ROWNUM <#offset# + #length#
		    ) WHERE rn >= #offset#
		]]>
    </select>
    <select id="MS_SELECT_CMSPAGE_BYTIME_COUNT"  resultClass="java.lang.Integer">
		 SELECT COUNT(*) FROM CMS_PAGE 	
		<isEqual compareValue="NODATE" property="date">
			<![CDATA[
			WHERE GMT_CREATE >= TO_DATE(#startTime#,'YYYY-MM-DD HH24:MI:SS') 
			      AND  GMT_CREATE < TO_DATE(#endTime#,'YYYY-MM-DD HH24:MI:SS')
			]]>	
		</isEqual>
		    ORDER BY GMT_CREATE DESC
    </select>

    <select id="MS_SELECT_URL_IN"  resultClass="String">
			SELECT cms_page.SPECIFIC_URL FROM cms_page WHERE cms_page.SPECIFIC_URL IN 
			<iterate property="urls" open="(" close=")" conjunction=",">
				#urls[]#
			</iterate>
    </select>    
    
    <select id="MS-GET-CMSPAGE-BY-POSITIONID"  resultMap="CmsPage-result" parameterClass="java.lang.Long">
            SELECT cp.GMT_CREATE,
                   cp.GMT_MODIFIED,
                   cp.ID,
                   cp.CATALOG_ID,
			       cp.TITLE,
			       cp.KEYWORDS,
			       cp.HEADER,
			       cp.STYLE,
			       cp.DESCRIPTION,
			       cp.STATUS,
			       cp.SPECIFIC_URL,
			       cp.DOMAIN_PATH_ID,
			       cp.FOOTER,
			       cp.INTERVAL_TIME,
			       cp.PAGE_TYPE,
			       cp.TAG ,GRID_TYPE,CP.URL,cp.APPLY_DEVICE,cp.BOX_PAGE_TYPE
			FROM CMS_PAGE cp, DCMS_POSITION dp WHERE cp.ID = dp.PAGE_ID AND dp.ID =#positionId#	
    </select>
    
    <select id="MS_GET_PENDING_AUDIT_PAGES_BY_PERIOD" resultMap="CmsPage-result">
      <![CDATA[
        select
            *
        from
            (
            select
                t.*,rownum as myrow
            from
                (select * from CMS_PAGE  
                 where STATUS = #status#  
                 ]]>
                <isNotEmpty prepend="AND" property="beginDate"> 
                	GMT_MODIFIED >= #beginDate#
                </isNotEmpty>
                <isNotEmpty prepend="AND" property="endDate"> 
                	GMT_MODIFIED <![CDATA[<=]]> #endDate#
                </isNotEmpty>                
             <![CDATA[
                 order by GMT_MODIFIED desc) t
            where             
                rownum<=#end#
            )
        where
            myrow>#begin#
            ]]>   
    </select>

	<select id="MS-GET-CMSPAGE-BY-APPID" resultMap="CmsPage-result"
		parameterClass="java.util.Map">
     <![CDATA[
            SELECT cp.GMT_CREATE,
                   cp.GMT_MODIFIED,
                   cp.ID,
                   cp.CATALOG_ID,
			       cp.TITLE,
			       cp.KEYWORDS,
			       cp.HEADER,
			       cp.STYLE,
			       cp.DESCRIPTION,
			       cp.STATUS,
			       cp.SPECIFIC_URL,
			       cp.DOMAIN_PATH_ID,
			       cp.FOOTER,
			       cp.INTERVAL_TIME,
			       cp.PAGE_TYPE,
			       cp.TAG ,GRID_TYPE,cp.URL,cp.APPLY_DEVICE,cp.BOX_PAGE_TYPE
			FROM CMS_PAGE cp WHERE rownum < 2000 AND cp.STATUS != 'disable' AND cp.PAGE_TYPE = #pageType#
		]]>
		<isNotEmpty prepend="AND" property="appId"> 
                	cp.DOMAIN_PATH_ID =#appId#
        </isNotEmpty>
		<isNotEmpty property="pageIds">
			<iterate property="pageIds" open=" AND cp.ID in (" close=")"
				conjunction=",">
				#pageIds[]#
			</iterate>
		</isNotEmpty>
		<![CDATA[
		  order by cp.GMT_MODIFIED desc
        ]]>
	</select>

	<select id="MS-SELECT-CMSPAGE-BY-TITLE-KEY"  resultMap="CmsPage-result" parameterClass="java.util.Map">
            SELECT * FROM CMS_PAGE WHERE TITLE=#title# and PAGE_TYPE = #pageType#	
    </select>
    
	<sql id="BASE-SELECT-BY-KEYWORDS">
          <![CDATA[
			   SELECT 
			         ID, USER_ID, TITLE, TAG, SPECIFIC_URL, GMT_MODIFIED, STATUS
			   FROM CMS_PAGE 
			   WHERE PAGE_TYPE = #pageType# 
		  ]]>	
		  <dynamic>		  
	  		  <isNotNull prepend = "AND" property="keyword">		  		          
	          <![CDATA[	
				          (  USER_ID = #keyword# 
				          OR REGEXP_LIKE(TAG, '(^|[[:space:]])' || #keyword# || '([[:space:]]|$$)' ) 
				          OR TITLE like '%'||#keyword#||'%' 
				          OR SPECIFIC_URL like '%'||#keyword#||'%'
				          ) 
	  		  ]]>
			  </isNotNull>  		  
	  		  <isNotNull prepend="AND" property="categorysId">
						ID in (SELECT RESOURCE_ID FROM CMS_RESOURCE_CATALOG_V2 where RESOURCE_TYPE='page'
						 and  CATALOG_ID in 
						 <iterate property="categorysId" open="(" close=")" conjunction=",">
			                      #categorysId[]#
			            </iterate>
						)
			  </isNotNull>
		  </dynamic>    
		  <!-- 注意这个后面还有排序，修改时需要谨慎 -->
	</sql>    
    
	<select id="MS_QUERY_PAGE_BY_TYPE_AND_KEYWORD" parameterClass="java.util.Map" resultClass="java.util.LinkedHashMap" resultMap="box-page-map">
          <![CDATA[
            SELECT * FROM (
             SELECT A.*,ROWNUM RN FROM ( 
          ]]>
		  <include refid="BASE-SELECT-BY-KEYWORDS"/>   			      
		  <isEqual property="orderCol" compareValue="updateTimeAsc" >
				<![CDATA[  ORDER BY GMT_MODIFIED ASC  ]]> 
		  </isEqual>  
		  <isEqual property="orderCol" compareValue="updateTimeDesc" >
				<![CDATA[  ORDER BY GMT_MODIFIED DESC  ]]>
		  </isEqual>			  	        
		  <![CDATA[	           
             ) A WHERE ROWNUM <= #offset# + #length#
            ) WHERE RN > #offset#
          ]]>            	
    </select>	
    
    <select id="MS-SEARCH-EXTERNAL-PAGE"  resultMap="CmsPage-result" parameterClass="map">
	  <![CDATA[
      SELECT * FROM (
         SELECT A.*,ROWNUM RN FROM (
            SELECT * FROM CMS_PAGE WHERE STATUS != 'disable'
      ]]>
            <dynamic>
			   <isNotEmpty prepend="AND" property = "intervalTime">
			  		INTERVAL_TIME = #intervalTime#
			  </isNotEmpty>
			  <isNotEmpty prepend="AND" property="pageType" >	
			        PAGE_TYPE = #pageType#
			  </isNotEmpty>			      
            </dynamic>
      <![CDATA[
            ORDER BY ID DESC
         ) A WHERE ROWNUM <= #offset# + #length#
      ) WHERE RN > #offset#
      ]]>
    </select>
    
    <select id="MS-COUNT-EXTERNAL-PAGE"  resultClass="java.lang.Integer" parameterClass="map">
            SELECT count(*) FROM CMS_PAGE  WHERE STATUS != 'disable'
            <dynamic>
			   <isNotEmpty prepend="AND" property = "intervalTime">
			  		INTERVAL_TIME = #intervalTime#
			  </isNotEmpty>
			  <isNotEmpty prepend="AND" property="pageType" >	
			        PAGE_TYPE = #pageType#
			  </isNotEmpty>				      
            </dynamic>
    </select>
	<select id="queryCmsPageForClean"  resultMap="CmsPageForClean-result" parameterClass="map">
select p.id,dm.domain || dp.context_path || p.specific_url as SPECIFIC_URL from cms_page p, cms_domain_path dp, cms_domain dm where p.domain_path_id = dp.id (+) and dp.domain_id = dm.id(+)
            <dynamic >
			  <isNotEmpty prepend="AND" property="pageType" >	
			        p.PAGE_TYPE = #pageType#
			  </isNotEmpty>	
			  <isNotNull prepend="AND" property="domain">
				 dm.domain in
					<iterate property="domain" open="(" close=")" conjunction=",">
						                      #domain[]#
		            </iterate>
		      </isNotNull>
			  <isNotEmpty prepend="AND" property="rownumLimit" >
				      <![CDATA[
				rownum <= #rownumLimit#
				      ]]>

			  </isNotEmpty>
			  <isNotEmpty prepend="AND" property="endTime" >	
			  		<![CDATA[
			        p.GMT_MODIFIED <=TO_DATE(#endTime#,'YYYY-MM-DD HH24:MI:SS')
			        ]]>	
			  </isNotEmpty>	
		      
            </dynamic>
    </select>
    
	<select id="MS_QUERY_PAGE_BY_TYPE_AND_KEYWORD_COUNT" parameterClass="java.util.Map" resultClass="java.lang.Integer">
		   <![CDATA[
             SELECT count(*) FROM ( 
          ]]>
		  <include refid="BASE-SELECT-BY-KEYWORDS"/>   			        
		  <![CDATA[	           
		    )
          ]]>  
	</select>        


  <select id="MS-COUNT-NEED-REPLACE-PAGE"  resultClass="java.lang.Integer" parameterClass="map">
  	 <![CDATA[
        select count(*)
          from cms_page a
         where a.header = 'user_defined_header'
           and a.id not in (select b.page_id from cms_rsc_task b)
           and a.page_type = 'ORDINARY'
           and a.domain_path_id in (1,2,3,4,25)
      ]]>
   </select>
   
   
   <select id="MS-SEARCH-NEED-REPLACE-PAGE"  resultMap="CmsPage-result" parameterClass="map">
	  <![CDATA[
      SELECT * FROM (
         SELECT A.*,ROWNUM RN FROM (
            select *
	          from cms_page A
	         where a.header = 'user_defined_header'
	           and a.id not in (select b.page_id from cms_rsc_task b)
	           and a.page_type = 'ORDINARY'
	           and a.domain_path_id in (1,2,3,4,25)
      ]]>
      <![CDATA[
            ORDER BY ID DESC
         ) A WHERE ROWNUM <= #offset# + #length#
      ) WHERE RN > #offset#
      ]]>
    </select>
    
    
    <update id="MS-UPDATE-VIFRAME-CMSPAGE-BY-ID" parameterClass="java.util.Map" >
       update
                        CMS_PAGE
       set
                    GMT_MODIFIED = sysdate,
					PAGE_TYPE = 'ORDINARY' 
		where ID = #pageId#			
    </update>
    <update id="MS-UPDATE-BOX-CMSPAGE-BY-ID" parameterClass="java.util.Map" >
	       update
	                        CMS_PAGE
	       set
	                    GMT_MODIFIED = sysdate,
	                                        PAGE_TYPE = 'BOX' 
	                where ID = #pageId#                     
	 </update>
    <select id="MS-GETPAGEID-BY-CATALOGANDSTATUS"   resultClass="java.util.List"  resultMap="CmsPageMap-result" parameterClass="map">
     <![CDATA[
		SELECT DISTINCT P.ID, P.PAGE_TYPE
  			FROM CMS_RESOURCE_CATALOG_V2 RC, CMS_PAGE P
 				WHERE RC.RESOURCE_TYPE = 'page'
   		]]>
 		<isNotEmpty prepend="AND" property = "status">
       			 P.STATUS = #status#
       </isNotEmpty>
       <![CDATA[
       AND RC.RESOURCE_ID = P.ID
       AND RC.CATALOG_ID IN
       (SELECT C.ID FROM CMS_CATALOG_V2 C START WITH C.ID in 
         ]]>
         <iterate property="catalogIds" open="(" close=")" conjunction=",">
		    #catalogIds[]#
		 </iterate>
		  <![CDATA[
        CONNECT BY PRIOR C.ID = C.PARENT_ID)
      ]]>
    </select>
	<select id="MS_GET_PAGELIST_FOR_EXTERNEL"  resultMap="CmsPage-result" parameterClass="java.util.Map">
		<![CDATA[
			SELECT *
			FROM   CMS_PAGE
			WHERE   1=1
		]]>
			<isNotEmpty prepend="AND" property="specificUrl">
				SPECIFIC_URL = #specificUrl#
			</isNotEmpty>	
			<isNotEmpty prepend="AND" property="title">
				TITLE = #title#
			</isNotEmpty>
			and	PAGE_TYPE = 'EXTERNAL'
		<![CDATA[
			ORDER BY ID DESC
		]]>
    </select>
    <select id="MS-COUNT-CMSPAGE-BY-SEARCH-TOPIC-PAGE"  resultClass="java.lang.Integer" parameterClass="map">
    	<![CDATA[
           SELECT count(0) FROM CMS_PAGE page,DCMS_BOX_TOPIC_AUDIT topic where page.id=topic.page_id  
        ]]> 
		     <isEmpty property = "specialUrl">
				  <isNotEmpty prepend="AND" property="title" >
			        title like '%'||#title#||'%'
			      </isNotEmpty>				 	      
			      <isNotEmpty prepend="AND" property="keywords" >
			        KEYWORDS like '%'||#keywords#||'%'
			      </isNotEmpty>
				  <isGreaterThan prepend="AND" property="domainId" compareValue="0">
					DOMAIN_PATH_ID in (SELECT ID FROM CMS_DOMAIN_PATH WHERE DOMAIN_ID=#domainId#)
			      </isGreaterThan>
			  </isEmpty>
			  <isNotEmpty prepend="AND" property="pageStatus">
					 topic.PAGE_STATUS = #pageStatus#
			  </isNotEmpty>	
			  <isNotEmpty prepend="AND" property = "specialUrl">
			  	 SPECIFIC_URL like '%'||#specialUrl#||'%'
			  </isNotEmpty>
			  <isNotEmpty prepend="AND" property="pageType" >	
			        PAGE_TYPE = #pageType#
			  </isNotEmpty>		
			  <isNotEmpty prepend="AND" property="userId" >	
			        page.USER_ID = #userId#
			  </isNotEmpty>
			  <isNotEmpty prepend="AND" property="approveUserId" >	
			        topic.USER_ID = #approveUserId#
			  </isNotEmpty>
			  		 		                 
    </select>
    <select id="MS-SELECT-CMSPAGE-BY-SEARCH-TOPIC-PAGE"  resultMap="CmsTopicPage-result" parameterClass="map">
	  <![CDATA[
      SELECT * FROM (
         SELECT A.*,ROWNUM RN FROM (
            SELECT page.*,topic.user_id  approve_user_id,topic.page_status,topic.remark FROM CMS_PAGE page,DCMS_BOX_TOPIC_AUDIT topic where page.id=topic.page_id 
      ]]>
             
		     <isEmpty property = "specialUrl">
				  <isNotEmpty prepend="AND" property="title" >
			        title like '%'||#title#||'%'
			      </isNotEmpty>				  
			      <isNotEmpty prepend="AND" property="keywords" >
			        KEYWORDS like '%'||#keywords#||'%'
			      </isNotEmpty>
				  <isGreaterThan prepend="AND" property="domainId" compareValue="0">
					DOMAIN_PATH_ID in (SELECT ID FROM CMS_DOMAIN_PATH WHERE DOMAIN_ID=#domainId#)
			      </isGreaterThan>
			  </isEmpty>
			  <isNotEmpty prepend="AND" property="pageStatus">
					 topic.PAGE_STATUS = #pageStatus#
			  </isNotEmpty>	
			  <isNotEmpty prepend="AND" property = "specialUrl">
			  	SPECIFIC_URL like '%'||#specialUrl#||'%'
			  </isNotEmpty>	
			  <isNotEmpty prepend="AND" property="pageType" >	
			         page.PAGE_TYPE = #pageType#
			  </isNotEmpty>	
			   <isNotEmpty prepend="AND" property="userId" >	
			        page.USER_ID = #userId#
			  </isNotEmpty>		
			  <isNotEmpty prepend="AND" property="approveUserId" >	
			        topic.USER_ID = #approveUserId#
			  </isNotEmpty>	      
            
      <![CDATA[
            ORDER BY page.ID DESC
         ) A WHERE ROWNUM <= #offset# + #length#
      ) WHERE RN > #offset#
      ]]>
    </select>
    
    <select id="MS-SELECT-CMSPAGE-BY-SEARCH-NEW"  resultMap="CmsTopicPage-result" parameterClass="map">
	  <![CDATA[
              SELECT page.*,topic.user_id  approve_user_id,topic.page_status,topic.remark FROM CMS_PAGE page
    
      left join DCMS_BOX_TOPIC_AUDIT topic on  page.id = topic.page_id 
      ]]>
            <dynamic prepend="WHERE">
		    
				  <isNotEmpty prepend="AND" property="title" >
			        instr(page.title, #title#)>0
			      </isNotEmpty>
				  <isNotEmpty property="pageIds" prepend="AND" >
				  	page.ID in 
						<iterate property="pageIds" open="(" close=")"
							conjunction=",">
							#pageIds[]#
						</iterate>
				  </isNotEmpty>
				  <isNotNull prepend="AND" property="siteId">
					page.ID in (SELECT RESOURCE_ID FROM CMS_RESOURCE_SITE where RESOURCE_TYPE='page'
					 and  SITE_ID in 
					 <iterate property="siteId" open="(" close=")" conjunction=",">
		                      #siteId[]#
		            </iterate>
					)
			      </isNotNull>
				  <isNotNull prepend="AND" property="catalogId">
					 page.ID in (SELECT RESOURCE_ID FROM CMS_RESOURCE_CATALOG_V2 where RESOURCE_TYPE='page'
					 and  CATALOG_ID in 
					 <iterate property="catalogId" open="(" close=")" conjunction=",">
		                      #catalogId[]#
		            </iterate>
					)
			      </isNotNull>
			      <isNotEmpty prepend="AND" property="keywords" >
			         instr(page.KEYWORDS, #keywords#)>0
			      </isNotEmpty>
				  <isGreaterThan prepend="AND" property="domainId" compareValue="0">
					 page.DOMAIN_PATH_ID in (SELECT ID FROM CMS_DOMAIN_PATH WHERE DOMAIN_ID=#domainId#)
			      </isGreaterThan>
			
			  <isNotEmpty prepend="AND" property = "specialUrl">
			  	 instr(page.SPECIFIC_URL, #specialUrl#)>0
			  </isNotEmpty>	
			  <isNotEmpty prepend="AND" property="pageType" >	
			         page.PAGE_TYPE = #pageType#
			  </isNotEmpty>	
			  <isNotEmpty prepend="AND" property="url" >	
			         page.URL = #url#
			  </isNotEmpty>
			   <isNotEmpty prepend="AND" property="userId" >	
			         page.USER_ID = #userId#
			  </isNotEmpty>		
			   <isNotEmpty prepend="AND" property="approveUserId" >	
			        topic.USER_ID = #approveUserId#
			  </isNotEmpty>	      
			  <isNotEmpty prepend="AND" property="pageStatus">
					 topic.PAGE_STATUS = #pageStatus#
			  </isNotEmpty>
			 <isNotEmpty property="applyDevice" prepend="">
				 <isNotEqual    prepend="and" property="applyDevice" compareValue="all">		             
				        (page.APPLY_DEVICE = #applyDevice# or  page.APPLY_DEVICE ='all'  or page.APPLY_DEVICE is null)			          
			      </isNotEqual>
			      <isEqual  prepend="and" property="applyDevice" compareValue="all">	
			            (page.APPLY_DEVICE ='all'  or page.APPLY_DEVICE is null)
			      </isEqual>
			</isNotEmpty>
            </dynamic>
      <![CDATA[
            ORDER BY  page.ID DESC
      ]]>
    </select>
    <update id="MS_UPDATE_CMSPAGE_GRIDTYPE_BY_PAGEID" parameterClass="java.util.Map" >
	       update
	                        CMS_PAGE
	       set
	                    GRID_TYPE= #gridType#      
	                where ID = #pageId#                     
	 </update>
    <select id="MS_GET_PAGELIST_FOR_FULL_URL"  resultMap="CmsPage-result" parameterClass="java.util.Map">
		<![CDATA[
			SELECT *
			FROM   CMS_PAGE p
		]]>
		WHERE   p.url=#url# 
		<![CDATA[
			ORDER BY ID DESC
		]]>
    </select>
    
    <!-- 个人创建的页面 -->
    <select id="MS_QUERY_MY_CREATE_PAGES" resultMap="CmsMyPageResult" parameterClass="java.util.Map">
		SELECT * FROM (
			SELECT page.*, ROWNUM rn FROM (
		    	SELECT t.id, t.title, t.url, t.status, t.page_type, t.apply_device, 
	    	  			t.user_id, t.gmt_create, t.modifier, t.gmt_modified, 
	    	  			t.last_publish_time, s.name site_name
				  FROM CMS_PAGE t, CMS_RESOURCE_SITE m, CMS_SITE s
				 where t.id = m.resource_id
				   AND m.site_id = s.id AND m.resource_type='page'
				   AND t.user_id=#userId#
				   ORDER BY t.gmt_modified desc
		<![CDATA[ 
		   ) page WHERE ROWNUM <= #offset# + #length#
		) WHERE RN > #offset#
		]]>
    </select>
    
    <!-- 个人创建且已发布的页面 -->
    <select id="MS_QUERY_MY_CREATE_PAGES_RELEASED" resultMap="CmsMyReleasedPageResult" parameterClass="java.util.Map">
		SELECT * FROM (
			SELECT page.*, ROWNUM rn FROM (
		    	SELECT t.id, t.title, t.url, t.status, t.page_type, t.apply_device, 
	    	  			t.modifier, t.last_publish_time
				  FROM CMS_PAGE t
				 where t.user_id=#userId#
				   AND t.last_publish_time is not null
				   ORDER BY t.gmt_modified desc
		<![CDATA[ 
		   ) page WHERE ROWNUM <= #offset# + #length#
		) WHERE RN > #offset#
		]]>
    </select>
    
    <!-- 个人收藏的页面 -->
    <select id="MS_QUERY_MY_FAVORITE_PAGES" resultMap="CmsMyPageResult" parameterClass="java.util.Map">
		SELECT * FROM (
			SELECT page.*, ROWNUM rn FROM (
	    	  	SELECT t.id, t.title, t.url, t.status, t.page_type, t.apply_device, 
	    	  			t.user_id, t.gmt_create, t.modifier, t.gmt_modified, 
	    	  			t.last_publish_time, s.name site_name
	    	  	  FROM CMS_PAGE t, CMS_RESOURCE_SITE m, CMS_SITE s, CMS_FAVORITE f
				 WHERE t.id = f.num_id and f.type = 'P'
				   AND t.id = m.resource_id AND m.resource_type = 'page'
				   AND m.site_id = s.id AND f.user_id = #userId# 
				 ORDER BY t.gmt_modified desc
	   <![CDATA[ 
	   		) page WHERE ROWNUM <= #offset# + #length#
	   ) WHERE RN > #offset#
	   ]]>
    </select>
    
    <!-- 个人收藏且已发布的页面 -->
    <select id="MS_QUERY_MY_FAVORITE_PAGES_RELEASED" resultMap="CmsMyReleasedPageResult" parameterClass="java.util.Map">
		SELECT * FROM (
			SELECT page.*, ROWNUM rn FROM (
	    	  	SELECT t.id, t.title, t.url, t.status, t.page_type, t.apply_device, 
	    	  			t.modifier, t.last_publish_time
	    	  	  FROM CMS_PAGE t, CMS_FAVORITE f
				 WHERE t.id = f.num_id and f.type = 'P'
				    AND f.user_id = #userId# 
				    AND t.last_publish_time is not null
				 ORDER BY t.gmt_modified desc
	   <![CDATA[ 
	   		) page WHERE ROWNUM <= #offset# + #length#
	   ) WHERE RN > #offset#
	   ]]>
    </select>
</sqlMap>
